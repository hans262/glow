import{r as f,a as R,j as o}from"./index.1da63547.js";import{u as b}from"./useSetState.12359b3d.js";import{D as w}from"./index.305a4de5.js";import{B as p}from"./button.52476b55.js";import"./index.a2923c53.js";import"./isVisible.7ca29fb7.js";import"./render.43ae6a3d.js";import"./AntdIcon.78424b7e.js";import"./Compact.9bf7b630.js";const m=(u,d)=>{requestAnimationFrame(n=>{m(u,d)});const r=new Uint8Array(u.frequencyBinCount),a=r.length,t=d.getContext("2d");u.getByteFrequencyData(r);const[c,l]=[600,300];d.width=c,d.height=l,t.fillStyle="rgb(200, 200, 200)",t.strokeStyle="rgb(0, 0, 0)",t.fillRect(0,0,c,l);let h=c/a,e=0;for(let n=0;n<a;n++){let s=r[n]*l/256;t.beginPath(),t.moveTo(e,0),t.lineTo(e,s),t.stroke(),e+=h}},F=()=>{const u=f.exports.createRef(),d=f.exports.useRef(),r=f.exports.useRef(),a=f.exports.useRef(),[t,c]=b({status:"inactive",chunks:[]});f.exports.useEffect(()=>{!u.current||navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{d.current=e,r.current=new MediaRecorder(e),r.current.ondataavailable=i=>{console.log(i.data),c(g=>({chunks:[...g.chunks,i.data]}))};const n=new AudioContext,s=n.createMediaStreamSource(e);a.current=n.createAnalyser(),a.current.fftSize=512,s.connect(a.current),m(a.current,u.current)}).catch(e=>{console.log(e)})},[]);const l=()=>{var e,n,s,i,g;((e=r.current)==null?void 0:e.state)==="inactive"?((n=r.current)==null||n.start(),c({status:"recording"})):(((s=r.current)==null?void 0:s.state)==="recording"||((i=r.current)==null?void 0:i.state)==="paused")&&((g=r.current)==null||g.stop(),c({status:"inactive"}))},h=()=>{var e,n,s,i;((e=r.current)==null?void 0:e.state)==="recording"?((n=r.current)==null||n.pause(),c({status:"paused"})):((s=r.current)==null?void 0:s.state)==="paused"&&((i=r.current)==null||i.resume(),c({status:"recording"}))};return R("div",{children:[o("h1",{children:"\u97F3\u9891\u91C7\u6837"}),o("canvas",{ref:u}),o(w,{}),o("div",{style:{display:"inline-block",verticalAlign:"top",marginRight:"10px",width:32,height:32,borderRadius:"50%",background:t.status==="inactive"?"rgb(10, 10, 10)":t.status==="recording"?"rgb(255, 0, 0)":"rgb(35, 116, 15)"}}),o(p,{onClick:l,children:t.status==="inactive"?"\u5F55\u5236":"\u7ED3\u675F"}),["recording","paused"].includes(t.status)&&o(p,{onClick:h,children:t.status==="recording"?"\u6682\u505C":"\u7EE7\u7EED"}),t.chunks.length>0&&o("audio",{controls:!0,src:window.URL.createObjectURL(new window.Blob(t.chunks,{type:"audio/webm; codecs=opus"}))}),o("div",{children:t.chunks.map((e,n)=>o("audio",{controls:!0,src:window.URL.createObjectURL(e)},n))})]})};export{F as default};
