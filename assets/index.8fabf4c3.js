var K=Object.defineProperty;var R=(n,t,e)=>t in n?K(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var s=(n,t,e)=>(R(n,typeof t!="symbol"?t+"":t,e),e);import{r as d,e as b,j as p}from"./index.1da63547.js";import{_ as L}from"./tslib.es6.9a4241f2.js";import{i as I,o as D,a as P}from"./util.ce8b15f4.js";import{a as U,u as z}from"./useMount.d3fcb0a7.js";var B=function(n){var t=d.exports.useRef(n);t.current=n,U(function(){return function(){return t.current()}})};const H=B;var A=d.exports.useState,M=d.exports.useEffect,W=d.exports.useRef,T=function(n){return setTimeout(n,35)},X=function(n,t){var e=t===void 0?{}:t,i=e.width,h=i===void 0?1/0:i,r=e.height,a=r===void 0?1/0:r;if(!I)return[typeof n=="function"?n({width:h,height:a}):n,{width:h,height:a}];var y=A({width:h,height:a}),m=y[0],S=y[1];typeof n=="function"&&(n=n(m));var x=n.props.style||{},w=W(null),c=null,l=function(){var o=w.current,f=o?{width:o.offsetWidth,height:o.offsetHeight}:{width:h,height:a};S(f)},k=function(o){P(o,"resize",l),T(l)};M(function(){var o=w.current;if(!!o){if(o.contentWindow)c=o.contentWindow,k(c);else{var f=function(){P(o,"load",f),c=o.contentWindow,k(c)};D(o,"load",f)}return function(){c&&c.removeEventListener&&D(c,"resize",l)}}},[]),x.position="relative";var E=d.exports.cloneElement.apply(b,L([n,{style:x}],L([p("iframe",{ref:w,style:{background:"transparent",border:"none",height:"100%",left:0,position:"absolute",top:0,width:"100%",zIndex:-1}})],d.exports.Children.toArray(n.props.children))));return[E,m]};const G=X,F="/glow/assets/gun_lens.eb2380cf.png",N="/glow/assets/blast.93e2f251.png",O="/glow/assets/duck_1.d88eb2c1.png",Y="/glow/assets/duck_2.e34b30f5.png",j="/glow/assets/duck_3.c5dbed84.png",q="/glow/assets/duck_4.a4e5c4cb.png",$="/glow/assets/ds_shot.392507b0.ogg",J="/glow/assets/ds_duck_hit.28c01460.ogg";async function Q(){const[n,t,e,i,h,r]=await Promise.all([u(F),u(N),u(O),u(Y),u(j),u(q)]);return{GUN_LENS:n,BLAST:t,DUCK_1:e,DUCK_2:i,DUCK_3:h,DUCK_4:r}}const u=n=>new Promise((t,e)=>{const i=new Image;i.src=n,i.onload=()=>{t(i)},i.onerror=h=>{e(h)}}),C={DS_SHOT:$,DS_DUCK_HIT:J},v=class{constructor(){}static get instance(){return this.ins||(this.ins=new v),this.ins}loadImage(t,e){const i=new Image;i.src=t,i.onload=()=>{e(i)}}playAudio(t){const e=document.createElement("audio");e.volume=.3,e.src=t,e.autoplay=!0}};let g=v;s(g,"ins",null);class V{constructor(t,e){s(this,"id",Date.now()+Math.random());s(this,"x",0);s(this,"y",0);s(this,"width",200);s(this,"height",200);s(this,"direction",0);s(this,"type",1);s(this,"liveProgress",0);s(this,"livePosition",[[0,0],[200,0],[400,0],[600,0],[800,0],[1e3,0],[1200,0],[1400,0]]);s(this,"deadProgress",0);s(this,"deadPosition",[[1600,0],[0,200],[200,200],[400,200],[600,200],[800,200],[1e3,200],[1200,200],[1400,200],[1600,200],[0,400],[200,400],[400,400],[600,400],[800,400],[1e3,400],[1200,400],[1400,400],[1600,400],[0,600],[200,600],[400,600],[600,600],[800,600],[1e3,600],[1200,600],[1400,600],[1600,600],[0,800],[200,800],[400,800],[600,800],[800,800],[1e3,800],[1200,800],[1400,800],[1600,800]]);s(this,"speedX",Math.random()*4);s(this,"speedY",Math.random()*4);s(this,"invalid",!1);s(this,"dead",!1);this.canvasWidth=t,this.canvasHeight=e,this.direction=~~(Math.random()*2);const i=t-this.width;this.x=i/2*Math.random()+i/2,this.y=e-this.height*2,this.type=~~(Math.random()*4)+1}getCenterBox(t){let{x:e,y:i}=this;this.direction&&(e=this.getDirectionX());const h=[e+this.width/2,i+this.height/2];return{x:h[0]-t/2,y:h[1]-t/2,width:t,height:t}}getDirectionX(){return this.canvasWidth/2-(this.x+this.width-this.canvasWidth/2)}updateDead(){this.dead=!0,g.instance.playAudio(C.DS_DUCK_HIT)}move(){this.dead?this.y+=6:(this.x-=this.speedX,this.y-=this.speedY),(this.x<0-this.width||this.y<0-this.height||this.y>this.canvasHeight)&&(this.invalid=!0)}update(){this.dead?this.updateDeadProgress():this.updateLiveProgress(),this.move()}updateDeadProgress(){let t=this.deadProgress+1;t=t>36?36:t,this.deadProgress=t}updateLiveProgress(){let t=this.liveProgress+1;t=t>7?0:t,this.liveProgress=t}}class _{constructor(t,e){s(this,"x",0);s(this,"y",0);s(this,"width",150);s(this,"height",150);s(this,"speed",10);s(this,"fireProgress",24);s(this,"firePosition",[[0,0],[200,0],[400,0],[600,0],[800,0],[0,200],[200,200],[400,200],[600,200],[800,200],[0,400],[200,400],[400,400],[600,400],[800,400],[0,600],[200,600],[400,600],[600,600],[800,600],[0,800],[200,800],[400,800],[600,800],[800,800]]);s(this,"fireing",!1);this.canvasWidth=t,this.canvasHeight=e}updateFireProgress(){let t=this.fireProgress+1;t>24&&(t=24,this.fireing=!1),this.fireProgress=t}getCenterBox(t){const e=[this.x+this.width/2,this.y+this.height/2];return{x:e[0]-t/2,y:e[1]-t/2,width:t,height:t}}fired(t){this.fireing=!0,this.fireProgress=0,g.instance.playAudio(C.DS_SHOT),t.forEach(e=>{const i=this.getCenterBox(10),h=e.getCenterBox(100);this.collide(i,h)&&e.updateDead()})}collide(t,e){const i=[t.x+t.width/2,t.y+t.height/2],h=[e.x+e.width/2,e.y+e.height/2],r=Math.abs(i[0]-h[0]),a=Math.abs(i[1]-h[1]);return r<=(t.width+e.width)/2&&a<=(t.height+e.height)/2}moveLeft(){let t=this.x-this.speed;t<0&&(t=0),this.x=t}moveRight(){let t=this.x+this.speed;t>this.canvasWidth-this.width&&(t=this.canvasWidth-this.width),this.x=t}moveTop(){let t=this.y-this.speed;t<0&&(t=0),this.y=t}moveBottom(){let t=this.y+this.speed;t>this.canvasHeight-this.height&&(t=this.canvasHeight-this.height),this.y=t}}class Z{constructor(t){s(this,"canvas");s(this,"ctx");s(this,"width");s(this,"height");s(this,"images",{});s(this,"keydowns",{});s(this,"gunLens");s(this,"ducks",[]);s(this,"suspend",!1);s(this,"onKeyDown",t=>{this.keydowns[t.key]=!0,this.keyDownHandle(t)});s(this,"onKeyUp",t=>{this.keydowns[t.key]=!1});s(this,"render",()=>{this.update(),this.clearCanvas(),this.draw(),this.suspend||requestAnimationFrame(this.render)});this.root=t;const{canvas:e,ctx:i}=this.createCanvas();this.canvas=e,this.ctx=i,t.appendChild(this.canvas);const h=this.root.getBoundingClientRect();this.canvas.width=h.width,this.canvas.height=h.height,this.width=h.width,this.height=h.height,this.gunLens=new _(this.width,this.height),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.setup()}resizeCanvs(){const t=this.root.getBoundingClientRect();this.canvas.width=t.width,this.canvas.height=t.height,this.width=t.width,this.height=t.height,this.gunLens=new _(this.width,this.height)}createCanvas(){const t=document.createElement("canvas"),e=t.getContext("2d");return t.style.border="1px solid",{canvas:t,ctx:e}}close(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}keyDownHandle(t){switch(t.code){case"Space":t.preventDefault(),this.gunLens.fired(this.ducks);return;case"KeyG":this.generateDuck();return;case"KeyX":this.switchSuspend();return}}switchSuspend(){this.suspend=!this.suspend,this.suspend||requestAnimationFrame(this.render)}generateDuck(){const t=~~(Math.random()*2)+1;for(let e=0;e<t;e++){const i=new V(this.width,this.height);this.ducks.push(i)}}async setup(){this.images=await Q(),this.render()}draw(){this.drawGunLens(),this.drawDuck()}drawDuck(){this.ducks.forEach(t=>{let e="DUCK_"+t.type;const i=this.images[e],h=t.dead?t.deadPosition[t.deadProgress]:t.livePosition[t.liveProgress],{width:r,height:a}=t;this.ctx.save(),t.direction&&(this.ctx.scale(-1,1),this.ctx.translate(-this.width,0)),this.ctx.drawImage(i,h[0],h[1],r,a,t.x,t.y,r,a),this.ctx.restore()})}update(){this.checkKeydowns(),this.gunLens.fireing&&this.gunLens.updateFireProgress(),this.ducks.forEach(t=>t.update()),this.ducks=this.ducks.filter(t=>!t.invalid)}checkKeydowns(){Object.keys(this.keydowns).forEach(t=>{if(!!this.keydowns[t])switch(t){case"a":return this.gunLens.moveLeft();case"d":return this.gunLens.moveRight();case"w":return this.gunLens.moveTop();case"s":return this.gunLens.moveBottom()}})}clearCanvas(){this.ctx.clearRect(0,0,this.width,this.height)}drawGunLens(){const{GUN_LENS:t,BLAST:e}=this.images;if(this.ctx.drawImage(t,this.gunLens.x,this.gunLens.y,this.gunLens.width,this.gunLens.height),!this.gunLens.fireing)return;const i=this.gunLens.firePosition[this.gunLens.fireProgress];this.ctx.drawImage(e,i[0],i[1],200,200,this.gunLens.x-25,this.gunLens.y-25,200,200)}}function ht(){const n=d.exports.useRef(null),t=d.exports.useRef(),[e,{width:i,height:h}]=G(()=>p("div",{}));return z(()=>{t.current=new Z(n.current)}),d.exports.useEffect(()=>{var r;(r=t.current)==null||r.resizeCanvs()},[i]),H(()=>{var r;(r=t.current)==null||r.close()}),p("div",{ref:n,style:{background:"#ccc",width:"100vw",height:"100vh"},children:e})}export{ht as default};
