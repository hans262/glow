(this.webpackJsonpglow=this.webpackJsonpglow||[]).push([[16],{458:function(e,t){},459:function(e,t){},467:function(e,t){},490:function(e,t){},491:function(e,t){},497:function(e,t,a){},558:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return k}));var n=a(4),r=a(14),i=a(17),s=a.n(i),c=a(2),o=a(23),l=a(51),d=a(54),u=a(59),h=a(60),f=a(0),p=a(527),m=28,v=28,b=784,g=10;function j(){return new Promise((function(e){var t=new Image,a=document.createElement("canvas"),n=a.getContext("2d");t.src="./mnist_images.png",t.onload=function(){t.width=t.naturalWidth,t.height=t.naturalHeight;var r=new ArrayBuffer(5096e4),i=5e3;a.width=t.width,a.height=i;for(var s=0;s<13;s++){n.drawImage(t,0,s*i,t.width,i,0,0,t.width,i);for(var c=n.getImageData(0,0,a.width,a.height),o=new Uint8Array(r,s*t.width*i,t.width*i),l=0;l<o.length;l++)o[l]=c.data[4*l]}var d=new Uint8Array(r).slice(0,392e5);e(d)}}))}function x(){return new Promise(function(){var e=Object(o.a)(s.a.mark((function e(t){var a,n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("./mnist_labels_uint8").then((function(e){return e.arrayBuffer()}));case 2:a=e.sent,n=new Uint8Array(a),r=n.slice(0,5e5),t(r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}var O=a(528),C=a(556),y=a(532),w=a(557),S=a(552),E=a(554),R=(a(497),function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,i=new Array(n),d=0;d<n;d++)i[d]=arguments[d];return(e=t.call.apply(t,[this].concat(i))).imageBoxRef=Object(f.createRef)(),e.canvasRef=Object(f.createRef)(),e.imageRef=Object(f.createRef)(),e.lossChart=null,e.accuracyChart=null,e.model=null,e.images=null,e.labels=null,e.trainBatchCount=0,e.state={mnistDataPending:!1,trainPending:!1,trainEpoch:1,valAcc:0,valLoss:0,trainProgress:0,predictResult:null},e.loadMnistData=Object(o.a)(s.a.mark((function t(){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.images||!e.labels){t.next=2;break}return t.abrupt("return",C.b.warning("data is loaded!"));case 2:return e.setState(Object(c.a)(Object(c.a)({},e.state),{},{mnistDataPending:!0})),t.next=5,Promise.all([j(),x()]);case 5:return a=t.sent,e.images=a[0],e.labels=a[1],e.setState(Object(c.a)(Object(c.a)({},e.state),{},{mnistDataPending:!1})),t.abrupt("return",C.b.success("loading done!"));case 10:case"end":return t.stop()}}),t)}))),e.train=Object(o.a)(s.a.mark((function t(){var a,n,r,i,l,d;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.model){t.next=2;break}return t.abrupt("return",C.b.warning("Model is not created!"));case 2:if(e.images&&e.labels){t.next=4;break}return t.abrupt("return",C.b.warning("Mnist data is not loaded!"));case 4:return a=e.state.trainEpoch,e.setState(Object(c.a)(Object(c.a)({},e.state),{},{trainPending:!0})),console.log("Training model..."),n=e.model,320,.15,r=p.h(e.images,[e.images.length/b,m,v,1]),i=p.g(e.labels,[e.labels.length/g,g]),l=0,d=Math.ceil(.85*r.shape[0]/320)*a,t.next=16,n.fit(r,i,{batchSize:320,validationSplit:.15,epochs:a,callbacks:{onBatchEnd:function(){var t=Object(o.a)(s.a.mark((function t(a,n){var r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l++,r=~~(l/d*100*100)/100,e.setState({trainProgress:r,valAcc:n.acc,valLoss:n.loss}),e.updateChart(n.loss,n.acc),a%10===0&&e.testImagePredict(),t.next=7,p.e();case 7:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),onEpochEnd:function(){var t=Object(o.a)(s.a.mark((function t(a,n){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Epoch: "+a+" Loss: "+n.loss),e.setState({valAcc:n.val_acc,valLoss:n.val_loss}),t.next=4,p.e();case 4:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),onTrainEnd:function(){console.log("Train done!"),e.setState(Object(c.a)(Object(c.a)({},e.state),{},{trainPending:!1}))}}});case 16:case"end":return t.stop()}}),t)}))),e.createConvModel=function(){if(e.model)return C.b.success("Model is created!");var t=p.f();t.add(p.d.conv2d({inputShape:[m,v,1],kernelSize:3,filters:16,activation:"relu"})),t.add(p.d.maxPooling2d({poolSize:2,strides:2})),t.add(p.d.conv2d({kernelSize:3,filters:32,activation:"relu"})),t.add(p.d.maxPooling2d({poolSize:2,strides:2})),t.add(p.d.conv2d({kernelSize:3,filters:32,activation:"relu"})),t.add(p.d.flatten({})),t.add(p.d.dense({units:64,activation:"relu"})),t.add(p.d.dense({units:10,activation:"softmax"})),t.compile({optimizer:"rmsprop",loss:"categoricalCrossentropy",metrics:["accuracy"]}),t.summary(),e.model=t,C.b.success("Model create done!")},e.createDenseModel=function(){if(e.model)return C.b.success("Model is created!");var t=p.f();t.add(p.d.flatten({inputShape:[m,v,1]})),t.add(p.d.dense({units:42,activation:"relu"})),t.add(p.d.dense({units:10,activation:"softmax"})),t.compile({optimizer:"rmsprop",loss:"categoricalCrossentropy",metrics:["accuracy"]}),t.summary(),e.model=t,C.b.success("Model create done!")},e.testImagePredict=function(){if(e.images&&e.labels&&e.model){var t=[100,200],a=t[1]-t[0],n=e.images.slice(b*t[0],t[1]*b),i=e.labels.slice(g*t[0],t[1]*g),s=p.h(n,[n.length/b,m,v,1]),c=i.reduce((function(e,t,a){return t?[].concat(Object(r.a)(e),[a%10]):e}),[]),o=e.model.predict(s),l=Array.from(o.argMax(1).dataSync());s.dispose(),o.dispose(),e.renderCanvas(n,a,l,c)}},e.predict=function(){var t=e.imageRef.current,a=e.canvasRef.current.getContext("2d");if(!e.model)return C.b.warning("Model is not created!");var n=p.b.fromPixels(t,1),r=p.c.resizeBilinear(n,[28,28]).as4D(1,28,28,1),i=e.model.predict(r),s=p.a(i,1).dataSync();e.setState(Object(c.a)(Object(c.a)({},e.state),{},{predictResult:s[0]})),a.fillRect(0,0,280,280)},e.initCanvas=function(){var t=e.canvasRef.current,a=e.imageRef.current;t.width=280,t.height=280;var n=t.getContext("2d");n.fillStyle="black",n.fillRect(0,0,280,280);var r=!1;t.addEventListener("mousedown",(function(e){r=!0})),t.addEventListener("mouseup",(function(e){r=!1,a.src=t.toDataURL("image/png")})),t.addEventListener("mousemove",(function(e){r&&(n.beginPath(),n.lineWidth=32,n.lineCap="round",n.strokeStyle="white",n.moveTo(e.offsetX,e.offsetY),n.lineTo(e.offsetX,e.offsetY),n.stroke())}))},e.updateChart=function(t,a){if(e.lossChart&&e.accuracyChart){var n=e.trainBatchCount++,i=[].concat(Object(r.a)(e.lossChart.getData()),[{batch:n,loss:t}]);e.lossChart.changeData(i);var s=[].concat(Object(r.a)(e.accuracyChart.getData()),[{batch:n,acc:a}]);e.accuracyChart.changeData(s)}},e.renderChart=function(){var t=new O.a({container:"lossChart",autoFit:!0,height:300,padding:50});t.data([]),t.line().position("batch*loss"),t.point().position("batch*loss").size(4).shape("circle").style({stroke:"#fff",lineWidth:1}),t.scale("loss",{alias:"LOSS"}),t.axis("loss",{title:{style:{fontSize:16,fill:"#aaaaaa"}}}),t.scale("batch",{alias:"BATCH"}),t.axis("batch",{title:{style:{fontSize:16,fill:"#aaaaaa"}}}),t.render(),e.lossChart=t;var a=new O.a({container:"accuracyChart",autoFit:!0,height:300,padding:50});a.data([]),a.line().position("batch*acc").style({stroke:"#facc15"}),a.point().position("batch*acc").size(4).shape("circle").style({stroke:"white",lineWidth:1,fill:"#facc15"}),a.scale("acc",{alias:"ACCURACY"}),a.axis("acc",{title:{style:{fontSize:16,fill:"#aaaaaa"}}}),a.scale("batch",{alias:"BATCH"}),a.axis("batch",{title:{style:{fontSize:16,fill:"#aaaaaa"}}}),a.render(),e.accuracyChart=a},e}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.initCanvas(),this.renderChart()}},{key:"renderCanvas",value:function(e,t,a,n){var r=this.imageBoxRef.current;r.innerHTML="";for(var i=0;i<t;i++){var s=e.slice(784*i,784*i+784),c=a[i],o=n[i],l=document.createElement("div");l.className="pred-container";var d=document.createElement("canvas");d.className="prediction-canvas";d.width=28,d.height=28;for(var u=d.getContext("2d"),h=new ImageData(28,28),f=0;f<784;f++){var p=4*f;h.data[p+0]=s[f],h.data[p+1]=s[f],h.data[p+2]=s[f],h.data[p+3]=255}u.putImageData(h,0,0);var m=document.createElement("div"),v=c===o;m.className=v?"pred-correct":"pred-incorrect",m.innerText="\u9884\u6d4b: ".concat(c),l.appendChild(m),l.appendChild(d),r.appendChild(l)}}},{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{className:"tf",children:[Object(n.jsx)("div",{className:"ftitle",children:"TRAINING PARAMETERS"}),Object(n.jsxs)("div",{className:"bt",children:[Object(n.jsx)(y.a,{loading:this.state.mnistDataPending,type:"primary",size:"large",onClick:this.loadMnistData,children:"LOAD DATA"}),Object(n.jsx)(y.a,{onClick:this.createConvModel,type:"primary",size:"large",children:"CREATE MODEL"}),Object(n.jsx)(y.a,{onClick:this.train,size:"large",danger:!0,loading:this.state.trainPending,children:"TRAIN MODEL"}),Object(n.jsx)("span",{style:{marginLeft:"10px"},children:"EPOCHS"}),Object(n.jsx)(w.a,{style:{marginLeft:"10px"},min:1,max:3,defaultValue:1,size:"large",onChange:function(t){"number"===typeof t&&e.setState(Object(c.a)(Object(c.a)({},e.state),{},{trainEpoch:t}))}})]}),Object(n.jsx)("div",{className:"ftitle",children:"TRAINING PROGRESS"}),Object(n.jsxs)("div",{children:[this.state.valAcc?Object(n.jsx)(S.a,{message:"\u7cbe\u5ea6\uff1a".concat(this.state.valAcc,"\uff0c\u8bef\u5dee\uff1a").concat(this.state.valLoss),type:"success"}):null,Object(n.jsx)(E.a,{percent:this.state.trainProgress,steps:30,strokeColor:"#52c41a"})]}),Object(n.jsx)("div",{id:"lossChart"}),Object(n.jsx)("div",{id:"accuracyChart"}),Object(n.jsx)("div",{className:"ftitle",children:"INFERENCE EXAMPLES"}),Object(n.jsx)("div",{ref:this.imageBoxRef,className:"pred"}),Object(n.jsx)("div",{className:"ftitle",children:"TEST MODEL"}),Object(n.jsx)("div",{className:"bt",children:Object(n.jsx)(y.a,{size:"large",type:"primary",onClick:this.predict,children:"PREDICT"})}),Object(n.jsxs)("div",{className:"draw",children:[Object(n.jsx)("canvas",{ref:this.canvasRef}),Object(n.jsx)("img",{alt:"",ref:this.imageRef,style:{width:280,height:280,marginLeft:"2px"}}),Object(n.jsx)("span",{style:{fontSize:"80px",marginLeft:"30px",fontWeight:600},children:this.state.predictResult})]})]})}}]),a}(f.PureComponent));function k(){return Object(n.jsx)("div",{children:Object(n.jsx)(R,{})})}}}]);
//# sourceMappingURL=16.99324396.chunk.js.map